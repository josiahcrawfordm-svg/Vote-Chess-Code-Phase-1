import java.util.*;
import java.util.concurrent.*;

class Player {
    String username;
    String team;
    int bullet, blitz, rapid, daily;
    String title;
    int tokens;
    boolean hasVoted = false;
    boolean left = false;

    public Player(String username, String team, int bullet, int blitz, int rapid, int daily, String title) {
        this.username = username;
        this.team = team;
        this.bullet = bullet;
        this.blitz = blitz;
        this.rapid = rapid;
        this.daily = daily;
        this.title = title;
        this.tokens = calculateTokens();
    }

    private int calculateTokens() {
        if (title != null && !title.isEmpty()) return 12;
        int highest = bullet;
        if (blitz > highest) highest = blitz;
        if (rapid > highest) highest = rapid;
        if (daily > highest) highest = daily;
        if (highest >= 2500) return 10;
        if (highest >= 2300) return 9;
        if (highest >= 2100) return 8;
        if (highest >= 1900) return 7;
        if (highest >= 1700) return 6;
        if (highest >= 1500) return 5;
        if (highest >= 1200) return 4;
        if (highest >= 800) return 3;
        return 2;
    }
}

// ChessGame + VoteManager + MoveRecord/GameHistory classes are same as Phase 4/5

public class PhaseSixMain {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        ChessGame game = new ChessGame();
        List<Player> players = new ArrayList<>();
        VoteManager voteManager = new VoteManager();
        GameHistory gameHistory = new GameHistory();

        // Player setup
        System.out.println("Number of players:");
        int n = Integer.parseInt(sc.nextLine());
        for(int i=0;i<n;i++){
            System.out.println("Player "+(i+1)+" username:");
            String username=sc.nextLine();
            System.out.println("Team (white/black):");
            String team=sc.nextLine();
            System.out.println("Bullet rating:"); int bullet=Integer.parseInt(sc.nextLine());
            System.out.println("Blitz rating:"); int blitz=Integer.parseInt(sc.nextLine());
            System.out.println("Rapid rating:"); int rapid=Integer.parseInt(sc.nextLine());
            System.out.println("Daily rating:"); int daily=Integer.parseInt(sc.nextLine());
            System.out.println("Title (GM, IM, FM, CM) or leave blank:");
            String title=sc.nextLine(); if(title.isEmpty()) title=null;
            players.add(new Player(username,team,bullet,blitz,rapid,daily,title));
        }

        // Main Game Loop
        while(true){
            game.printBoard();
            System.out.println("\n--- Voting Phase ---");

            long startTime = System.currentTimeMillis();
            long endTime = startTime + 10_000; // Simulated voting window for testing

            while(System.currentTimeMillis() < endTime){
                for(Player p:players){
                    if(p.left) continue;
                    // Enforce team turn
                    if(p.team.equals(game.whiteToMove?"white":"black") && !p.hasVoted){
                        System.out.println(p.username+", enter move (e4, Ng5) or 'Leave':");
                        if(sc.hasNextLine()){
                            String move=sc.nextLine();
                            if(move.equalsIgnoreCase("Leave")) {p.left=true; continue;}
                            voteManager.castVote(p, move);
                        }
                    }
                }
            }

            String bestMove = voteManager.getWinningMove();
            if(bestMove!=null){
                System.out.println("Winning move: "+bestMove);
                game.makeMove(bestMove);
                gameHistory.addMove(bestMove, game);
            } else System.out.println("No votes cast.");

            voteManager.resetVotes(players);

            // Remove players who left permanently
            players.removeIf(p->p.left);
            if(players.stream().noneMatch(p->p.team.equals("white")) || players.stream().noneMatch(p->p.team.equals("black"))){
                System.out.println("One team has no players left. Game ends.");
                break;
            }
        }

        // Print final game history
        gameHistory.printHistory();
    }
}
